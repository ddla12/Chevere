(()=>{"use strict";const t={getElementsBy:t=>[...t.element.querySelectorAll(t.selector)].map((e=>new t.Child({element:e,parent:t.parent,attr:{attribute:t.attribute,values:{original:e.getAttribute(t.attribute)}}}))),parser:t=>new Function([...t.args?.keys()||""].join(","),`return ${t.expr}`).bind(t.node)(...t.args?.values()||""),getElementsByDataOn(t){const a=e.bindOrOn(t.attribute);return[...t.parent.element.querySelectorAll("*")].filter((t=>[...t.attributes].map((t=>t.name)).some((t=>a.test(t))))).map((e=>new t.Child({element:e,parent:t.parent,attr:[...e.attributes].map((t=>t.name)).filter((t=>a.test(t))).map((t=>({attribute:t,values:{original:e.getAttribute(t)}})))})))},eventCallback:t=>new Function("$event, $el",t.expr).bind(t.node,t.$event,t.$el)(),reactive:t=>new Proxy(t.object,{get:(t,e,a)=>Reflect.get(t,e,a),set:(e,a,r,i)=>(t.beforeSet&&t.beforeSet(e,a,r),Reflect.set(e,a,r,i),t.afterSet&&t.afterSet(e,a,r),!0)})},e={loop:t=>new RegExp(String.raw`^${t}|(?<=\[)${t}(?=\])?|((?<=(\,|\())|(?<=\s+))${t}(?!\:)|(?<=\$\{)${t}`,"g"),$this:t=>new RegExp(String.raw`^this\.${t}\.[a-zA-Z]`,"g"),bindOrOn:t=>new RegExp(String.raw`^data-${t}:|@${t}`)},a=String.raw`^(\!)?(true|false|this\.data\.\w+)`,r={$data:e.$this("data"),arguments:/(?<=\().*(?=\))/g,removePar:/.*\(|\)$/g,isLogicalExpression:new RegExp(String.raw`${a}(\s+)?(\||&|=|!=|(>|<)(=)?)`),isVariableAssign:/^this\.data\.\w+(\s)?(\?\?||\+|\-|\*|\/|\%|\*\*|<<?|>>(>)?|\|(\|)?||\&(\&)?|\^)?=/,isString:/^(\`).*\1$/,isObject:/^\{.*\}$/,isBoolean:new RegExp(`${a}$`),methodSyntax:/(^\w+$)|(^.*?\((.*)?\)$)/,bindAndOn:/^(data-(on|bind):|@(on|bind))/,bind:/^(data-)/,for:/^\w+(\s+)in(\s+)this\.data\.\w+/,forParent:/this\..*/g};class i{constructor(t){({element:this.element,parent:this.parent,attr:this.attr}=t)}setAction(){}ifAttrIsEmpty(t){if(!t.values.original)throw new SyntaxError(`The '${t.attribute}' attribute cannot be empty`)}}class s extends i{constructor(t){super(t),this.attr?.some((t=>this.ifAttrIsEmpty(t))),this.parseAttribute()}refreshAttribute(){let e=this.attr.map((t=>t.attribute.replace(r.bindAndOn,"").replace(/\..*/,"")));this.attr.forEach(((a,r)=>{("window"!=a.attribute.replace(/^.*\./,"")?this.element:window).addEventListener(e[r],(e=>{t.eventCallback({$event:e,expr:a.values.original.includes("$emitSelf")?a.values.original:`$event.stopPropagation();${a.values.original}`,node:this.parent,$el:this.element})}))}))}parseAttribute(){try{if(this.attr.some((t=>!r.methodSyntax.test(t.values.original)&&!r.isVariableAssign.test(t.values.original))))throw new SyntaxError("A 'data-on' attribute only accepts a method or a assignment as value");this.refreshAttribute()}catch(t){console.error(t)}}}class n extends i{constructor(t){if(super(t),this.pos=[...this.parent.element.children].indexOf(this.element),this.variables={loop:this.element.dataset.for.match(/^\w+/)[0],parent:this.element.dataset.for.match(r.forParent)[0].replace("this.data.","")},this.templates={content:this.element.content,fragment:document.createDocumentFragment()},1!=this.templates.content.querySelectorAll(":scope > *").length)throw new Error("A template with 'data-for' attribute can only have one direct child");this.parseAttribute()}refreshAttribute(){if(!(this.parent.data[this.variables.parent]instanceof Array))throw new TypeError(`Cannot execute a for loop with the '${this.variables.parent}' variable,it must be an array`);this.parent.data[this.variables.parent].forEach(((t,a)=>{const r=[...this.templates.content.querySelectorAll("*")],i={before:`this.data.${this.variables.parent}[${a-1}]`,current:`this.data.${this.variables.parent}[${a}]`};r.forEach((t=>{[...t.attributes].filter((t=>t.textContent.includes(0==a?this.variables.loop:i.before))).forEach((t=>{t.textContent=t.textContent.replace(0==a?e.loop(this.variables.loop):i.before,i.current)}))})),this.templates.fragment.append(document.importNode(this.templates.content,!0))})),this.parent.element.insertBefore(this.templates.fragment,this.parent.element.children[this.pos])}parseAttribute(){try{if(!r.for.test(this.attr.values.original))throw new SyntaxError("data-for attribute must follow the pattern 'var in vars'");this.refreshAttribute()}catch(t){console.error(t)}}}class l extends i{constructor(t){super(t),this.variable=this.attr.values.original.replace("this.data.",""),this.inputType=this.element.type,"checkbox"==this.inputType&&(this.related=[...this.parent.element.querySelectorAll(`input[type='checkbox'][data-model='this.data.${this.variable}']`)].filter((t=>t!=this.element))),this.ifAttrIsEmpty(this.attr),this.parseAttribute()}bindData(){["radio","checkbox"].includes(this.inputType)||(this.element.value=String(this.parent.data[this.variable]))}setAction(){this.parent.data[this.variable]="checkbox"!=this.inputType?this.element.value:this.related?.length&&0!=[...this.related,this.element].filter((t=>t.checked)).length?[...this.related,this.element].filter((t=>t.checked)).map((t=>t.value)):this.element.checked}refreshAttribute(){this.element.addEventListener("input",this.setAction.bind(this)),this.bindData()}parseAttribute(){try{if(!this.attr?.values.original.match(r.$data))throw new SyntaxError("The 'data-model' attribute only accept a property reference as value");this.refreshAttribute()}catch(t){console.error(t)}}}class h extends i{constructor(t){super(t),this.ifAttrIsEmpty(this.attr),this.parseAttribute()}setAction(){this.element.textContent=this.attr.values.current()}refreshAttribute(){this.attr.values.current=()=>t.parser({expr:this.attr?.values.original,node:this.parent}),this.setAction()}parseAttribute(){try{if(r.isObject.test(this.attr?.values.original)||r.methodSyntax.test(this.attr?.values.original))throw new SyntaxError("The 'data-text' attribute only accept strings concatenation, template literals, and a variable as reference");this.refreshAttribute()}catch(t){console.error(t)}}}class o extends i{constructor(t){super(t),this.display=getComputedStyle(this.element).display,this.ifAttrIsEmpty(this.attr),this.parseAttribute()}setAction(){this.element.style.display=this.attr.values.current()?this.display:"none"}refreshAttribute(){this.attr.values.current=()=>t.parser({expr:this.attr.values.original,node:this.parent}),this.setAction()}parseAttribute(){try{if(!r.isBoolean.test(this.attr.values.original)&&!r.isLogicalExpression.test(this.attr.values.original))throw new SyntaxError("data-show attribute only accept booleans");this.refreshAttribute()}catch(t){console.error(t)}}}class c extends i{constructor(t){super(t),t.attr.some((t=>this.ifAttrIsEmpty(t))),this.attr=t.attr.map((t=>({attribute:t.attribute,values:{original:t.values.original},bindAttr:t.attribute.replace(r.bindAndOn,""),bindValue:this.element.dataset[t.attribute.replace(r.bindAndOn,"")]||"",type:r.isString.test(t.values.original)?"string":r.isObject.test(t.values.original)?"object":"variable"}))),this.parseAttribute()}setAction(){this.attr.forEach((t=>t.predicate()))}refreshAttribute(){this.attr.filter((t=>["style","class"].includes(t.bindAttr))).forEach((e=>{let a=this.attr.indexOf(e);this.attr[a].values.current=()=>t.parser({expr:this.attr[a].values.original,node:this.parent})}));const[e,a]=[this.attr.findIndex((t=>"style"==t.bindAttr)),this.attr.findIndex((t=>"class"==t.bindAttr))];this.attr[e]&&(this.attr[e].predicate=()=>["string","variable"].includes(this.attr[e].type)?this.element.style.cssText=this.attr[e].values.current()+this.attr[e].bindValue:Object.assign(this.element.style,this.attr[e].values.current())),this.attr[a]&&(this.attr[a].predicate=()=>this.element.className=["string","variable"].includes(this.attr[a].type)?this.attr[a].values.current()+" ":Object.entries(this.attr[a].values.current()).filter((([,t])=>t)).map((([t])=>t)).join(" ")+" "+this.attr[a].bindValue),this.attr.filter((t=>!["style","class"].includes(t.bindAttr))).forEach((e=>{if(r.isObject.test(e.values.original))throw new SyntaxError("Only 'style' and 'class' attribute accepts an object as value /\n                    any other atttribute can only receive either a variable or a template string");let a=this.attr.indexOf(e);this.attr[a].values.current=()=>t.parser({expr:this.attr[a].values.original,node:this.parent}),e.predicate=()=>this.element.setAttribute(e.bindAttr,e.values.current())})),this.setAction()}parseAttribute(){try{if(this.attr.some((t=>!r.isString.test(t.values.original)&&!r.isObject.test(t.values.original))))throw new SyntaxError("A 'data-bind' attribute only accepts an object or a template string as value");this.refreshAttribute()}catch(t){console.error(t)}}}class d{constructor(t,e){if(this.data={},({name:this.name,watch:this.watch,init:this.init,updated:this.updated,updating:this.updating}=t),this.element=e,this.element.dataset.inline&&this.element.dataset.attached)throw new Error("A component cannot have both 'data-' attributes ('inline', 'attached')");if(this.id=this.element.dataset.id=this.setId(),t.data&&(this.data=this.parseData(t.data)),t.methods&&(this.methods=this.parseMethods(t.methods)),this.watch&&Object.keys(this.watch).some((t=>{if(!this.data[t])throw new ReferenceError(`You're trying to watch an undefined property '${t}'`)})),this.refs=this.findRefs(),null==this.init&&r.arguments.test(this.element.dataset.init))throw new EvalError(`The ${this.name||"Some"} components don't have an init() function, therefore they do not accept any parameters`);this.init&&this.executeInit(),this.checkForActionsAndChilds(),Object.seal(this)}setId(){return Math.random().toString(32).substr(2)}executeInit(){let e=t.parser({expr:"["+this.element.dataset.init+"]"});return this.init instanceof Promise?(async()=>await this.init(...e))():this.init(...e)}findRefs(){return[...this.element.querySelectorAll("*[data-ref]")].reduce(((t,e)=>{if(!e.dataset.ref)throw new SyntaxError("data-ref attribute cannot be empty");if(Object.keys({...t}).some((t=>t==e.dataset.ref)))throw new SyntaxError("It seems like there are repeated 'data-ref' values, check your 'data-ref' attributes");return{...t,[e.dataset.ref]:e}}),{})}refreshChilds(t,e){this.childs[t].filter((t=>t.attr?.values.original.includes(e))).forEach((t=>{t.setAction()}))}checkForActionsAndChilds(){if(this.element.querySelectorAll("*[data-inline], *[data-attached]").length)throw Error("Child components is an unsupported feature, sorry about that");this.childs={"data-for":t.getElementsBy({attribute:"data-for",element:this.element,parent:this,selector:"template[data-for]",Child:n}),"data-text":t.getElementsBy({attribute:"data-text",element:this.element,parent:this,selector:"*[data-text]",Child:h}),"data-show":t.getElementsBy({attribute:"data-show",element:this.element,parent:this,selector:"*[data-show]",Child:o}),"data-model":t.getElementsBy({attribute:"data-model",element:this.element,parent:this,selector:"input[data-model], select[data-model], textarea[data-model]",Child:l}),"data-on":t.getElementsByDataOn({attribute:"on",Child:s,parent:this}),"data-bind":t.getElementsByDataOn({attribute:"bind",Child:c,parent:this})}}$emitSelf(t){this.childs["data-on"].filter((e=>e.attr.some((e=>e.attribute.includes(t.name))))).forEach((e=>e.element.dispatchEvent(new CustomEvent(t.name,{detail:t.detail,bubbles:!0,composed:!0,cancelable:!0}))))}$emit(t){window.dispatchEvent(new CustomEvent(t.name,{detail:t.detail,bubbles:!0,composed:!0,cancelable:!0}))}updateRelated(t){["data-show","data-text"].forEach((e=>this.refreshChilds(e,t))),this.childs["data-model"].filter((e=>e.variable==t)).forEach((t=>t.bindData())),this.childs["data-bind"].forEach((t=>t.setAction()))}parseMethods(t){return Object.values(t).reduce(((t,e)=>({...t,[e.name]:new Proxy(e,{apply:(t,e,a)=>{this.updating&&this.updating();const r=t.apply(this,[...a]);return this.updated&&this.updated(),r}})})),{})}parseData(e){return t.reactive({object:e,beforeSet:(t,e,a)=>{this.updating&&this.updating(),this.watch&&this.watch[e]?.apply(this,[a,t[e]])},afterSet:(t,e)=>{this.updateRelated(e),this.updated&&this.updated()}})}}class u extends d{constructor(t,e){super(t,e)}}class p extends d{constructor(e){super(t.parser({expr:e.dataset.inline||"{}"}),e)}}const m={start(...t){[...document.querySelectorAll("*[data-attached]")].map((t=>({el:t,attr:t.dataset.attached}))).forEach((e=>{const a=(()=>{let a=t.find((t=>t.name==e.attr.trim()));if(!a)throw new ReferenceError(`'${a}' couldn't be found in any of your declared components`);return a})();new u(a,e.el)})),[...document.querySelectorAll("*[data-inline]")].map((t=>new p(t)))},makeNodes(t,...e){e.forEach((e=>new u(t,e)))}};Object.defineProperty(window,"Chevere",{value:m})})();